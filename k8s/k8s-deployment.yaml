# Kubernetes API 版本
apiVersion: apps/v1
# 資源類型：Deployment
kind: Deployment
metadata:
  # 部署名稱
  name: fastapi-app-deployment
  labels:
    app: fastapi-app
spec:
  # 希望運行多少個副本 (Pod)
  replicas: 3 
  selector:
    matchLabels:
      app: fastapi-app
  template:
    metadata:
      labels:
        app: fastapi-app
    spec:
      containers:
      - name: fastapi-app-container
        # 使用您已經 Build 並 Push 到 Docker Hub 的 Image
        image: vic0119/devops-app:latest 
        # 容器內部 App 運行的 Port (FastAPI 預設的 8000)
        ports:
        - containerPort: 8000
        # 健康檢查：確保 App 正在運行 (使用您的 /health 路徑)
        livenessProbe:
          httpGet:
            path: /health 
            port: 8000
          initialDelaySeconds: 15
          periodSeconds: 20
        # 就緒檢查：確保 App 可以開始接收流量
        readinessProbe:
          httpGet:
            path: /health
            port: 8000
          initialDelaySeconds: 5
          periodSeconds: 10